<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <link rel="shortcut icon" href="NdcLogo4848.ico" type="image/x-icon">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Vial 网站</title>
        <link rel="stylesheet" type="text/css" href="../StyleFiles/homepage.css">
        <script type="text/javascript" src="./UpdateGp/echarts.js"></script>
        <script type="text/javascript" src="./UpdateGp/UpdateGp2.js"></script>
       <nav>
        <div class="nav-container">
            <a href="#" class="logo">Vial 网站 - 虚拟股票</a>
            <ul class="nav-links">
                <li><a href="../index.html">首页</a></li>
                <li><a href="index.html">购买</a></li>
                <li><a href="GpMg.html">我的股票</a></li>
                <li><a href="..//HomeWp/Vialac.html">我的 Vial ID</a></li>
            </ul>
        </div>
    </nav>
        <style>
        #echarts{
            display: flex;
            flex-wrap:wrap;
            width: 100%;
            justify-content:space-around;
        }
        #first{
            width: 48%;
            height: 600px;
            display: inline-block; 
            box-shadow: 1px 1px 10px #888888;
            border-radius: 30px;   
            margin-top: 20px;
        }
        #second{
            width: 48%;
            height: 600px;
            display: inline-block;  
            border-radius: 30px;   
            box-shadow: 1px 1px 10px #888888;  
            margin-top: 20px;
        }
        #first1{
            width: 100%;
            height: 600px;
            display: inline-block; 
            box-shadow: 1px 1px 10px #888888;
            border-radius: 30px;   
            margin-top: 20px;
        }
        @media screen and (max-width:957px){
            #first{
                width: 957px;
            }
            #second{
                width: 957px;
            }
        }
    </style>
    </head>
    <body>
        <script type="text/javascript">
            if(typeof(Storage)!=="undefined")
            {
                if(isNaN(Number(localStorage.money)))
                {
                    localStorage.money=0;
                }
                if(isNaN(Number(localStorage.nn)))
                {
                    localStorage.nn=1;
                }
                if(Number(localStorage.nn)==1&&Number(localStorage.money)==0)
                {
                    localStorage.name="新用户"+Math.floor(Math.random()*(100000-0+1));
                    localStorage.nn=0;
                }
                let nnn=Number(localStorage.money);
        	    document.addEventListener("DOMContentLoaded", function(){
        	    });
            }
            else
            {
                document.addEventListener("DOMContentLoaded", function() {
                    alert("您的设备可能不支持 localStorge，暂时无法正常使用 Vial网站。")
                });
            }
        </script>
        <div id="echarts">
        <div id="first"></div>
    <script>
        var updateInterval1,updateInterval;
        window.onresize = function() {
            myChart.resize();
        };
        var chartDom = document.getElementById('first');
        var myChart = echarts.init(chartDom);
        myChart.setOption(mygpp());
        function updateChart1() {
            if (myChart) {
                const option = mygpp();
                myChart.setOption(option);
            }
            console.log("更新了我的股票");
        }
        if (!updateInterval) {
                updateInterval = setInterval(updateChart1, 1000);
            }
        if (!updateInterval1) {
                updateInterval1 = setInterval(update_all, 1000);
            }
    </script>
</div>
<p>&nbsp;</p>
<center>
    <section class="hero">
        <center><h2>卖出股票</h2></center>
        &nbsp;
        &nbsp;
<div>
    <input type="checkbox" id="one">第1个 &nbsp; &nbsp;<input type="checkbox" id="two">第2个 &nbsp; &nbsp;<input type="checkbox" id="three">第3个 &nbsp; &nbsp;
</div>
<script>
    if(localStorage.sel1=="0")
    {
        document.getElementById("one").disabled=true;
    }
    if(localStorage.sel2=="0")
    {
        document.getElementById("two").disabled=true;
    }
    if(localStorage.sel3=="0")
    {
        document.getElementById("three").disabled=true;
    }

    function Sell() {
            let hasSold = false;
            if (document.getElementById("one").checked) {
                const sel4 = localStorage.sel4;
                const buy4 = Number(localStorage.buy4);
                if (buy4 <= 0) {
                    alert("无法卖出第1个股票。");
                    return;
                }
                const nowPrice = buychecknowprice(sel4);
                const pastPrice = buycheckpastprice(sel4);
                const nowValue = (buy4 * nowPrice / localStorage.p4).toFixed(2);
                const profit = (nowValue - buy4).toFixed(2); // 盈利/亏损
                const confirmMsg = `确定卖出股票[${buycheckname(sel4)}]吗？\n` +
                                  `购买金额：${buy4} Orgent币\n` +
                                  `当前市值：${nowValue} Orgent币\n` +
                                  `${profit >= 0 ? '盈利' : '亏损'}：${Math.abs(profit)} Orgent币`;
                if (!confirm(confirmMsg)) return;
                localStorage.money = (Number(localStorage.money) + Number(nowValue)).toFixed(2);
                localStorage.sel4 = 0;
                localStorage.buy4 = 0;
                localStorage.p4=0;
                localStorage.d4=0;
                hasSold = true;
            }
            if (document.getElementById("two").checked) {
                const sel2 = localStorage.sel2;
                const buy2 = Number(localStorage.buy2);
                if (buy2 <= 0) {
                    alert("无法卖出第2个股票。");
                    return;
                }
                const nowPrice = buychecknowprice(sel2);
                const pastPrice = buycheckpastprice(sel2);
                const nowValue = (buy2 * nowPrice / localStorage.p2).toFixed(2);
                const profit = (nowValue - buy2).toFixed(2);

                const confirmMsg = `确定卖出股票[${buycheckname(sel2)}]吗？\n` +
                                  `购买金额：${buy2} Orgent币\n` +
                                  `当前市值：${nowValue} Orgent币\n` +
                                  `${profit >= 0 ? '盈利' : '亏损'}：${Math.abs(profit)} Orgent币`;
                if (!confirm(confirmMsg)) return;

                localStorage.money = (Number(localStorage.money) + Number(nowValue)).toFixed(2);
                localStorage.sel2 = 0;
                localStorage.buy2 = 0;
                localStorage.p2=0;
                localStorage.d2=0;
                hasSold = true;
            }
            if (document.getElementById("three").checked)
            {
                const sel3 = localStorage.sel3;
                const buy3 = Number(localStorage.buy3);
                if (buy3 <= 0) {
                    alert("无法卖出第3个股票。");
                    return;
                }
                const nowPrice = buychecknowprice(sel3);
                const pastPrice = buycheckpastprice(sel3);
                const nowValue = (buy3 * nowPrice / localStorage.p3).toFixed(2);
                const profit = (nowValue - buy3).toFixed(2);

                const confirmMsg = `确定卖出股票 [${buycheckname(sel3)}] 吗？\n` +
                                  `购买金额：${buy3} Orgent币\n` +
                                  `当前市值：${nowValue} Orgent币\n` +
                                  `${profit >= 0 ? '盈利' : '亏损'}：${Math.abs(profit)} Orgent币`;
                if (!confirm(confirmMsg)) return;

                localStorage.money = (Number(localStorage.money) + Number(nowValue)).toFixed(2);
                localStorage.sel3 = 0;
                localStorage.buy3 = 0;
                localStorage.p3=0;
                localStorage.d3=0;
                hasSold = true;
            }
            if (!hasSold)
            {
                alert("请先选中要卖出的股票。");
                return;
            }
            window.location.href = "index.html";
        }
</script>
</center>
<p>&nbsp;</p>
    <center><button class="btn" id="sll" onclick="javascript:Sell()">卖出</button>
    <p>&nbsp;</p>
</section>
    </body>

</html>





